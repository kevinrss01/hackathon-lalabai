# Travel Research Agent Service

This service uses OpenAI's Agents SDK to provide comprehensive travel research capabilities.

## Setup

1. Make sure you have your OpenAI API key set in the environment:

   ```bash
   OPENAI_API_KEY=your-api-key-here
   ```

2. Install dependencies (if not already done):

   ```bash
   cd backend
   pnpm install
   ```

3. Start the server:
   ```bash
   pnpm dev
   ```

## Testing the Service

### Quick Test with Default Scenario

Run the pre-configured test (Paris to London trip):

```bash
cd backend
pnpm test:travel
```

This will test the scenario:

- The user lives in Paris on the Champs-Elys√©es
- The user wants to travel to London
- Current date is June 28th
- The user wants to depart on June 30th in the morning

### Interactive Testing with Custom Queries

Test with your own travel queries (use third person):

```bash
# Basic usage
pnpm test:travel:custom "The user wants to travel from New York to Boston tomorrow"

# With budget constraints
pnpm test:travel:custom "The user wants to travel from Barcelona to Madrid with a budget of 100 euros"

# Complex query
pnpm test:travel:custom "The user needs to go from San Francisco to Seattle next Friday and wants to return on Sunday evening. The user prefers trains over flights"

# Show help
pnpm test:travel:custom --help
```

## Prompt Format

The service expects prompts in third person format. This is because the prompts will be generated by another AI/filter that transforms user queries into structured prompts.

### Good Prompt Examples:

```
The user lives in Tokyo and wants to travel to Osaka.
The user needs to arrive by 3 PM on December 20th.
The user has a budget of 15,000 yen.
The user prefers the fastest route available.
```

### Structured Prompt Template:

```
The user lives in [ORIGIN_CITY].
The user wants to travel to [DESTINATION_CITY].
The current date is [CURRENT_DATE].
The user wants to depart on [DEPARTURE_DATE] at [DEPARTURE_TIME].
[Additional preferences or constraints]
```

## API Endpoint

### Research Travel

**POST** `/api/examples/travel/research`

#### Request Body

```json
{
  "query": "The user wants to travel from Paris to London on December 15th"
}
```

#### Response

```json
{
  "success": true,
  "data": {
    "response": "**TRAVEL SUMMARY**\n- Origin: Paris, France\n- Destination: London, United Kingdom\n...",
    "sources": [
      "https://www.eurostar.com",
      "https://www.skyscanner.com"
      // ... other relevant URLs extracted from the response
    ]
  }
}
```

## Example Usage

### Using cURL:

```bash
curl -X POST http://localhost:4000/api/examples/travel/research \
  -H "Content-Type: application/json" \
  -d '{"query": "The user wants to travel from Paris to London on December 15th"}'
```

### Using JavaScript/TypeScript:

```typescript
const response = await fetch('http://localhost:4000/api/examples/travel/research', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    query: 'The user wants to travel from New York to Los Angeles next week',
  }),
});

const data = await response.json();
console.log(data.data.response);
```

## Sample Queries (Third Person)

1. **Simple trip**: "The user wants to travel from Paris to London"
2. **With dates**: "The user wants to travel from Tokyo to Osaka on January 20th"
3. **With preferences**: "The user wants to travel from Barcelona to Madrid with a budget of 100 euros"
4. **Complex query**: "The user needs to travel from San Francisco to Seattle next Friday, returning Sunday evening. The user prefers trains over flights"

## Response Format

The agent will provide structured information including:

- **Travel Summary**: Origin, destination, distance, and dates
- **Transportation Options**: Various modes of transport with:
  - Duration
  - Cost estimates
  - Booking platforms
  - Pros and cons
  - Direct booking links
- **Travel Schedule**: Best departure times and arrival estimates
- **Practical Information**: Documents, weather, local transport, currency
- **Tips & Recommendations**: Actionable travel advice
- **Points of Interest**: Attractions along the route and at destination
- **Sources & Booking Links**: All relevant websites and platforms

## Architecture

The service consists of:

1. **AgentService** (`src/services/agent.service.ts`): Main service that interacts with OpenAI's Agents SDK
2. **ExampleController** (`src/controllers/example.controller.ts`): HTTP endpoint handler
3. **Routes** (`src/routes/example.routes.ts`): Route definition
4. **Test Scripts** (`tests/`): Test utilities for the travel agent

The agent uses GPT-4 (gpt-4o model) with carefully crafted instructions to provide comprehensive, structured travel information.

## Error Handling

The service includes error handling for:

- Missing query parameter (400 Bad Request)
- OpenAI API errors (500 Internal Server Error)
- Invalid API key configuration

## Notes

- The agent provides general travel information based on GPT's knowledge
- For real-time flight/train availability, integrate with actual booking APIs
- Sources are automatically extracted from the response when URLs are mentioned
- The service is stateless - each request is independent
- Prompts should be written in third person for consistency
